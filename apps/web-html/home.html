<!doctype html>
<html lang="ko">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Home · OTT Style</title>
<style>
  :root{
    --bg:#0b0f14; --bg-2:#0f141a; --card:#11161d; --ink:#e5ecf3;
    --sub:#9fb3c8; --accent:#60a5fa; --muted:#1a232c; --border:#1f2a36;
  }
  *{ box-sizing: border-box; }
  body{ margin:0; background:var(--bg); color:var(--ink); font: 15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
  .page{ min-height:100dvh; display:flex; flex-direction:column; }
  header{ padding:14px 16px; position:sticky; top:0; z-index:5; background:linear-gradient(180deg, rgba(11,15,20,.9), rgba(11,15,20,.75), rgba(11,15,20,0) 100%); backdrop-filter: blur(8px); }
  h1{ font-size:18px; margin:0; color:#cfe4ff; letter-spacing:.2px; }
  main{ flex:1 1 auto; padding: 8px 12px 80px; }
  .band{ margin:14px 4px 8px; }
  .band .head{ display:flex; align-items:center; justify-content:space-between; padding: 4px 4px 8px; }
  .band .title{ font-weight:700; font-size:16px; color:#cfe4ff; }
  .grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
  .card{ position:relative; color:inherit; text-decoration:none; background:var(--card); border-radius:14px; overflow:hidden; aspect-ratio: 2/3; box-shadow: 0 6px 24px rgba(0,0,0,.24); }
  .card img{ width:100%; height:100%; object-fit:cover; display:block; }
  .card .label{
    position:absolute; left:0; right:0; bottom:0;
    padding:8px 10px;
    background:linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.75));
  }
  .card .label .name{ font-weight:700; font-size:14px; color:#fff; }
  .card .label .bio{ font-size:12px; color:#cfe4ff; margin-top:2px; }
  .more{ color:var(--sub); font-size:13px; cursor:not-allowed; }
  .nav{ position:sticky; bottom:0; z-index:10; background:linear-gradient(0deg, rgba(11,15,20,1), rgba(11,15,20,.9)); border-top:1px solid var(--border); }
  .nav ul{ margin:0; padding: 10px 12px calc(env(safe-area-inset-bottom)+8px); display:grid; grid-template-columns: repeat(5, 1fr); gap: 10px; list-style:none; }
  .nav button{ width:100%; background:var(--muted); color:#b8c7d6; border:1px solid var(--border); border-radius:12px; padding:10px 8px; cursor:pointer; }
  .nav button:active{ transform: translateY(1px); }
  .toast{ position:fixed; left:50%; bottom: calc(env(safe-area-inset-bottom) + 74px); transform: translateX(-50%);
          background: rgba(15,20,26,.94); color:#d7e5f5; border: 1px solid var(--border); border-radius: 12px; padding: 10px 14px; z-index: 40;
          box-shadow: 0 8px 26px rgba(0,0,0,.35); display:none; }
  .toast.show{ display:block; }

  .dungeon-card{
    background:var(--card); border-radius:16px; overflow:hidden;
    margin:16px 0; box-shadow:0 6px 20px rgba(0,0,0,.3);
  }
  .dungeon-card img.hero{ width:100%; height:180px; object-fit:cover; }
  .dungeon-card .info{ padding:12px; }
  .dungeon-card h2{ margin:0 0 6px; font-size:18px; }
  .dungeon-card p{ margin:0 0 10px; font-size:14px; color:var(--sub); }
  .dungeon-card .start{ display:inline-block; background:var(--accent); color:#05223e;
    padding:6px 12px; border-radius:10px; font-weight:700; text-decoration:none; }

  @media(min-width:768px){
    main{ max-width: 960px; margin: 0 auto; }
  }
</style>

<header><h1>캐릭터 선택</h1></header>
<main id="root">
  <section class="band">
    <div class="head">
      <div class="title">캐릭터 선택</div>
    </div>
    <div id="grid" class="grid"></div>
  </section>
</main>

<nav class="nav">
  <ul>
    <li><button data-action="logo">Logo</button></li>
    <li><button data-action="search">Search</button></li>
    <li><button data-action="create">Create</button></li>
    <li><button data-action="mylist">My List</button></li>
    <li><button data-action="my">My</button></li>
  </ul>
</nav>

<div id="toast" class="toast">준비 중입니다</div>

<script>
function toast(msg){
  const t = document.getElementById('toast');
  if(!t) return alert(msg);
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 2000);
}

async function fetchCharacters(offset=0, limit=120){
  try{
    const base = location.origin;                            // 절대경로로 고정
    const r = await fetch(`${base}/v1/characters?offset=${offset}&limit=${limit}`);
    if(!r.ok){ throw new Error(`HTTP ${r.status}`); }
    const j = await r.json();
    console.debug('[characters]', j);
    return j.items || [];
  }catch(err){
    console.error(err);
    toast('목록을 불러오지 못했어요');
    return [];
  }
}

function card(item){
  const el = document.createElement('a');
  el.className = 'card';
  el.href = `/chat?character_id=${item.id}`;
  el.innerHTML = `
    <img src="${item.image}" alt="${item.name}">
    <div class="label">
      <div class="name">${item.name}</div>
      <div class="bio">${item.summary || ''}</div>
    </div>`;
  return el;
}

// 전역 에러도 잡아서 바로 확인
window.addEventListener('error', (e)=>{
  console.error('JS Error:', e.error || e.message);
  toast('스크립트 오류가 있어요 (F12 확인)');
});

(async function init(){
  const grid = document.getElementById('grid');
  grid.innerHTML = '';

  const items = await fetchCharacters(0, 120);
  if(items.length === 0){
    // 비어있을 때도 표시
    const empty = document.createElement('div');
    empty.style.gridColumn = '1 / -1';
    empty.style.color = '#9fb3c8';
    empty.style.padding = '12px 4px';
    empty.textContent = '표시할 캐릭터가 없습니다.';
    grid.appendChild(empty);
    return;
  }
  items.forEach(it => grid.appendChild(card(it)));
})();
</script>
</html>
