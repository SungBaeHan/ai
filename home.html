<!doctype html>
<html lang="ko">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Home · OTT Style</title>
<style>
  :root{
    --bg:#0b0f14; --bg-2:#0f141a; --card:#11161d; --ink:#e5ecf3;
    --sub:#9fb3c8; --accent:#60a5fa; --muted:#1a232c; --border:#1f2a36;
  }
  *{ box-sizing: border-box; }
  body{ margin:0; background:var(--bg); color:var(--ink); font: 15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
  .page{ min-height:100dvh; display:flex; flex-direction:column; }
  header{ padding:14px 16px; position:sticky; top:0; z-index:5; background:linear-gradient(180deg, rgba(11,15,20,.9), rgba(11,15,20,.75), rgba(11,15,20,0) 100%); backdrop-filter: blur(8px); }
  h1{ font-size:18px; margin:0; color:#cfe4ff; letter-spacing:.2px; }
  main{ flex:1 1 auto; padding: 8px 12px 80px; }
  .band{ margin:14px 4px 8px; }
  .band .head{ display:flex; align-items:center; justify-content:space-between; padding: 4px 4px 8px; }
  .band .title{ font-weight:700; font-size:16px; color:#cfe4ff; }
  .grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
  .card{ position:relative; color:inherit; text-decoration:none; background:var(--card); border-radius:14px; overflow:hidden; aspect-ratio: 2/3; box-shadow: 0 6px 24px rgba(0,0,0,.24); }
  .card img{ width:100%; height:100%; object-fit:cover; display:block; }
  .card .label{ 
    position:absolute; left:0; right:0; bottom:0;
    padding:8px 10px;
    background:linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.75));
  }
  .card .label .name{ font-weight:700; font-size:14px; color:#fff; }
  .card .label .bio{ font-size:12px; color:#cfe4ff; margin-top:2px; }
  .more{ color:var(--sub); font-size:13px; cursor:not-allowed; }
  .nav{ position:sticky; bottom:0; z-index:10; background:linear-gradient(0deg, rgba(11,15,20,1), rgba(11,15,20,.9)); border-top:1px solid var(--border); }
  .nav ul{ margin:0; padding: 10px 12px calc(env(safe-area-inset-bottom)+8px); display:grid; grid-template-columns: repeat(5, 1fr); gap: 10px; list-style:none; }
  .nav button{ width:100%; background:var(--muted); color:#b8c7d6; border:1px solid var(--border); border-radius:12px; padding:10px 8px; cursor:pointer; }
  .nav button:active{ transform: translateY(1px); }
  .toast{ position:fixed; left:50%; bottom: calc(env(safe-area-inset-bottom) + 74px); transform: translateX(-50%);
          background: rgba(15,20,26,.94); color:#d7e5f5; border: 1px solid var(--border); border-radius: 12px; padding: 10px 14px; z-index: 40;
          box-shadow: 0 8px 26px rgba(0,0,0,.35); display:none; }
  .toast.show{ display:block; }

  .dungeon-card{ 
    background:var(--card); border-radius:16px; overflow:hidden;
    margin:16px 0; box-shadow:0 6px 20px rgba(0,0,0,.3);
  }
  .dungeon-card img.hero{ width:100%; height:180px; object-fit:cover; }
  .dungeon-card .info{ padding:12px; }
  .dungeon-card h2{ margin:0 0 6px; font-size:18px; }
  .dungeon-card p{ margin:0 0 10px; font-size:14px; color:var(--sub); }
  .dungeon-card .start{ display:inline-block; background:var(--accent); color:#05223e;
    padding:6px 12px; border-radius:10px; font-weight:700; text-decoration:none; }


  @media(min-width:768px){
    main{ max-width: 960px; margin: 0 auto; }
  }
</style>

<header><h1>캐릭터 선택</h1></header>
<main id="root"></main>

<nav class="nav">
  <ul>
    <li><button data-action="logo">Logo</button></li>
    <li><button data-action="search">Search</button></li>
    <li><button data-action="create">Create</button></li>
    <li><button data-action="mylist">My List</button></li>
    <li><button data-action="my">My</button></li>
  </ul>
</nav>

<div id="toast" class="toast">준비 중입니다</div>

<script>
  // Fallback data (will be replaced by JSON files if fetch succeeds)
  const DEFAULT_HOME = {
  "layoutVersion": "home_v1",
  "bands": [
    {
      "id": "band_row_1",
      "title": "캐릭터 선택 ①",
      "layout": "grid",
      "cardAspect": "2:3",
      "itemsPerRow": {
        "phone": 3,
        "tablet": 4
      },
      "items": [
        {
          "id": "char_01",
          "type": "chat",
          "image": "char_01.png",
          "title": "세라"
        },
        {
          "id": "char_02",
          "type": "chat",
          "image": "char_02.png",
          "title": "리나"
        },
        {
          "id": "char_03",
          "type": "chat",
          "image": "char_03.png",
          "title": "하나"
        }
      ]
    },
    {
      "id": "band_row_2",
      "title": "캐릭터 선택 ②",
      "layout": "grid",
      "cardAspect": "2:3",
      "itemsPerRow": {
        "phone": 3,
        "tablet": 4
      },
      "items": [
        {
          "id": "char_04",
          "type": "chat",
          "image": "char_04.png",
          "title": "미노"
        },
        {
          "id": "char_05",
          "type": "chat",
          "image": "char_05.png",
          "title": "유키"
        },
        {
          "id": "char_06",
          "type": "chat",
          "image": "char_06.png",
          "title": "레이"
        }
      ]
    }
  ],
  "nav": [
    "Logo",
    "Search",
    "Create",
    "My List",
    "My"
  ]
};
  const DEFAULT_CHARACTERS = {
  "characters": [
    {
      "id": "char_01",
      "name": "세라",
      "archetype": "쾌활한 검사",
      "shortBio": "결단이 빠르고 농담을 좋아한다. 위험 상황에서도 분위기를 띄운다.",
      "image": "char_01.png",
      "tags": [
        "TRPG",
        "캐릭터"
      ],
      "systemPrompt": "너는 TRPG 동료 세라(쾌활한 검사)다. 구어체로 간결하게 말하라. 사용자가 선택지를 고르면 그 선택의 결과를 함께 탐색한다.",
      "greeting": "안녕! 난 세라. 상황을 간단히 알려줘. 같이 풀어보자."
    },
    {
      "id": "char_02",
      "name": "리나",
      "archetype": "차분한 마법사",
      "shortBio": "정보를 차분히 정리해 주고, 말투는 부드럽다.",
      "image": "char_02.png",
      "tags": [
        "TRPG",
        "캐릭터"
      ],
      "systemPrompt": "너는 TRPG 동료 리나(차분한 마법사)다. 구어체로 간결하게 말하라. 사용자가 선택지를 고르면 그 선택의 결과를 함께 탐색한다.",
      "greeting": "안녕! 난 리나. 상황을 간단히 알려줘. 같이 풀어보자."
    },
    {
      "id": "char_03",
      "name": "하나",
      "archetype": "엉뚱한 탐정",
      "shortBio": "호기심이 많고 관찰력이 좋다. 엉뚱한 추리를 던지기도 한다.",
      "image": "char_03.png",
      "tags": [
        "TRPG",
        "캐릭터"
      ],
      "systemPrompt": "너는 TRPG 동료 하나(엉뚱한 탐정)다. 구어체로 간결하게 말하라. 사용자가 선택지를 고르면 그 선택의 결과를 함께 탐색한다.",
      "greeting": "안녕! 난 하나. 상황을 간단히 알려줘. 같이 풀어보자."
    },
    {
      "id": "char_04",
      "name": "미노",
      "archetype": "무뚝뚝한 경호원",
      "shortBio": "말수는 적지만 신뢰할 수 있다. 보호 본능이 강하다.",
      "image": "char_04.png",
      "tags": [
        "TRPG",
        "캐릭터"
      ],
      "systemPrompt": "너는 TRPG 동료 미노(무뚝뚝한 경호원)다. 구어체로 간결하게 말하라. 사용자가 선택지를 고르면 그 선택의 결과를 함께 탐색한다.",
      "greeting": "안녕! 난 미노. 상황을 간단히 알려줘. 같이 풀어보자."
    },
    {
      "id": "char_05",
      "name": "유키",
      "archetype": "생기 넘치는 학생",
      "shortBio": "밝고 에너지가 넘친다. 소소한 감정 표현이 잦다.",
      "image": "char_05.png",
      "tags": [
        "TRPG",
        "캐릭터"
      ],
      "systemPrompt": "너는 TRPG 동료 유키(생기 넘치는 학생)다. 구어체로 간결하게 말하라. 사용자가 선택지를 고르면 그 선택의 결과를 함께 탐색한다.",
      "greeting": "안녕! 난 유키. 상황을 간단히 알려줘. 같이 풀어보자."
    },
    {
      "id": "char_06",
      "name": "레이",
      "archetype": "현실주의 전략가",
      "shortBio": "실리를 중시하고 선택지를 현실적으로 평가한다.",
      "image": "char_06.png",
      "tags": [
        "TRPG",
        "캐릭터"
      ],
      "systemPrompt": "너는 TRPG 동료 레이(현실주의 전략가)다. 구어체로 간결하게 말하라. 사용자가 선택지를 고르면 그 선택의 결과를 함께 탐색한다.",
      "greeting": "안녕! 난 레이. 상황을 간단히 알려줘. 같이 풀어보자."
    }
  ]
};

  async function loadJSON(path, fallback){
    try{
      const res = await fetch(path);
      if(!res.ok) throw new Error(res.statusText);
      return await res.json();
    }catch(e){
      return fallback;
    }
  }

  function card(char){
    const el = document.createElement('div');
    el.className = 'dungeon-card';
    el.innerHTML = `
      <img class="hero" src="${resolvePath(char.image||'')}">
      <div class="info">
        <h2>${char.name}</h2>
        <p>${char.shortBio||''}</p>
        <a href="chat.html?character=${encodeURIComponent(char.id)}" class="start">▶ 시작하기</a>
      </div>`;
    return el;
  }

  function resolvePath(p){
    if(!p) return '';
    if(/^https?:|^data:/.test(p)) return p;
    return p.replace(/^\/+/, ''); // 앞의 슬래시 제거
  }

  function band(section, charsById){
    const wrap = document.createElement('section');
    wrap.className = 'band';
    const head = document.createElement('div');
    head.className = 'head';
    head.innerHTML = '<div class="title">'+ section.title +'</div><div class="more">More</div>';
    const grid = document.createElement('div');
    grid.className = 'grid';
    for(const item of section.items){
      const ch = charsById[item.id];
      if(ch) grid.appendChild(card(ch));
    }
    wrap.appendChild(head);
    wrap.appendChild(grid);
    return wrap;
  }

  function toast(msg='준비 중입니다'){
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(()=> t.classList.remove('show'), 1600);
  }

  document.querySelectorAll('.nav button').forEach(b=>{
    b.addEventListener('click', ()=> toast());
  });

  (async function init(){
    const root = document.getElementById('root');
    const home = await loadJSON('/json/home.json', DEFAULT_HOME);
    const charsData = await loadJSON('/json/characters.json', DEFAULT_CHARACTERS);
    const charsById = Object.fromEntries((charsData.characters||[]).map(c => [c.id, c]));

    for(const sec of home.bands || []){
      root.appendChild(band(sec, charsById));
    }
  })();
</script>
</html>
